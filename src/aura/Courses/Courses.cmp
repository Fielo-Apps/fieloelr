<aura:component controller="CoursesController" implements="flexipage:availableForAllPageTypes,forceCommunity:availableForAllPageTypes" access="global" >  
    
    <aura:attribute type="sObject" name="moduleContent" />
    
    <aura:attribute name="configDefault" type="String" access="global" default='{"fieldset":[{"apiName":"Name","type":"subcomponent","subcomponent":"FieloELR:ShowRecord","label":{"type":"default"},"showLabel":true},{"apiName":"FieloELR__Description__c","type":"output","label":{"type":"default"},"showLabel":true},{"apiName":"JoinCourse","type":"subcomponent","subcomponent":"FieloELR:JoinCourse","label":{"type":"text","value":"Join Course"},"showLabel":false}],"quantity":6,"Course":{"fieldset":[{"apiName":"Name","type":"output","label":{"type":"default"},"showLabel":true},{"apiName":"FieloELR__Description__c","type":"output","label":{"type":"default"},"showLabel":true},{"apiName":"FieloELR__ApprovalGrade__c","type":"output","label":{"type":"default"},"showLabel":true},{"apiName":"TakeModule","type":"subcomponent","subcomponent":"FieloELR:TakeModule","label":{"type":"text","value":""},"showLabel":false}],"moduleResponse":[{"apiName":"FieloELR__NumberOfAttempt__c","label":{"type":"default"},"type":"output","showLabel":true}]}}'/>
    
    <!-- DESIGN ATTRIBUTES -->    
    <aura:attribute type="String" name="titleValue" access="global"/>
    <aura:attribute type="String" name="layout" access="global" />
    <aura:attribute type="Integer" name="columns" access="global" />    
    <aura:attribute type="String" name="courseDetailFields" access="global" />
    <aura:attribute type="String" name="courseLayout" access="global" />    
    <aura:attribute name="courseColumns" type="String" access="global" />
    <aura:attribute name="fields" type="String" access="global" />        
    <!-- DESIGN ATTRIBUTES -->


    <aura:attribute type="Boolean" name="reloadCourses" default="true" />
    <aura:attribute type="Boolean" name="viewAnswer" default="false" />
    
    <aura:attribute type="Boolean" name="showCoursesList" default="false" />
    <aura:attribute type="FieloELR__Course__c[]" name="courses" />
    <aura:attribute type="FieloELR__Course__c[]" name="coursesList" />
    
    <aura:attribute type="Boolean" name="showModuleResponse" default="false" />
    <aura:attribute type="sObject" name="moduleResponse" />
    
    <aura:attribute type="FieloELR__Module__c[]" name="modules" />
    <aura:attribute type="sObject[]" name="courseFieldset" />
    <aura:attribute type="Boolean" name="showCourse" default="false" />
    
    <aura:attribute type="Boolean" name="showModule" default="false" />
    <aura:attribute type="sObject" name="moduleRecord" default="" />
    <aura:attribute type="String" name="moduleTitle" default="" />
    
    <aura:attribute type="sObject[]" name="fieldset" />
    
    <!-- MODULE RESPONSE -->
    <aura:attribute type="sObject[]" name="moduleResponseFieldset" />
    <aura:attribute type="String" name="moduleResponseFields" access="global" />
    <!-- MODULE RESPONSE -->
    
    <aura:attribute type="String" name="title" default="" />    
    <aura:attribute type="String" name="whereClause" default="" />    
    
    <aura:attribute type="String" name="courseTitle" default="" />
    
    <aura:attribute type="FieloPLT__Member__c" name="member" />
    
    <aura:handler event="FieloPLT:UpdateMemberEvent" action="{!c.updateMember}"/>
    
    
    <aura:handler name="showRecord" event="c:ShowRecordEvent" action="{!c.showCourse}"/>
    
    <aura:handler event="c:TakeModuleEvent" action="{!c.takeModule}"/>
    
    <aura:handler event="c:ShowModuleResponseEvent" action="{!c.showModuleResponse}"/>
    
    <aura:handler name="init" action="{!c.doInit}" value="{!this}"/>    
    
    <!-- PAGINADOR -->
    <aura:attribute name="paging" type="Boolean" access="global"  />
    <aura:attribute name="quantity" type="Integer" access="global" />    
    <aura:handler name="paging" event="c:PaginatorEvent" action="{!c.paginator}" default="false"/>        
    <!-- PAGINADOR -->

    <!-- ERROR -->
    <aura:attribute name="showError" type="Boolean" />
    <aura:attribute name="error" type="String" />
    <!-- ERROR -->   
    
    <aura:if isTrue="{!v.reloadCourses}">
        <aura:if isTrue="{!v.showCoursesList}">
            <c:ListView objectAPIName="FieloELR__Course__c" layout="{!v.layout}" columns="{!v.columns}" fieldset="{!v.fieldset}" records="{!v.coursesList}" paging="{!v.paging}" quantity="{!v.quantity}" title="{!v.title}"/>
        </aura:if>
        
        <aura:if isTrue="{!v.showCourse}">        
            <div class="slds-clearfix">
                <aura:if isTrue="{!v.courseTitle}">
                    <h3 class="slds-section-title--divider slds-float_left">{!v.courseTitle}</h3>
                </aura:if>
                <lightning:button class="slds-float_right" variant="neutral" label="Back to Courses" onclick="{!c.showCoursesList }" />
            </div>
            
            <c:ListView objectAPIName="FieloELR__Module__c" layout="{!v.courseLayout}" columns="{!v.courseColumns}" fieldset="{!v.courseFieldset}" records="{!v.modules}" paging="false" />
        </aura:if>
        
        <aura:if isTrue="{!v.showModule}">        
            <div class="slds-clearfix">
                <h3 class="slds-section-title--divider slds-float_left">{!v.moduleTitle}</h3>        
                <lightning:button class="slds-float_right" variant="neutral" label="Back to Course" onclick="{!c.showCourseInformation }" />            
            </div>                
            <c:Module module="{!v.moduleRecord}" moduleContent="{!v.moduleContent}"/>
        </aura:if>
        
        <aura:if isTrue="{!v.showModuleResponse}">
            <div class="slds-clearfix slds-p-bottom--small">
                <h3 class="slds-section-title--divider slds-float_left">{!v.moduleTitle}</h3>        
                <aura:if isTrue="{!v.viewAnswer}">
                    <lightning:button class="slds-float_right" variant="neutral" label="Back to Course" onclick="{!c.showCourseInformation }" />            
                </aura:if>    
                <aura:if isTrue="{!!v.viewAnswer}">
                    <lightning:button class="slds-float_right" variant="neutral" label="Back to Courses" onclick="{!c.reloadCourses }" />            
                </aura:if>                                
            </div>                            
            <c:ModuleResponse moduleResponse="{!v.moduleResponse}" fieldset="{!v.moduleResponseFieldset}" fieldsModuleResponse="{!v.moduleResponseFields}"/>       
        </aura:if>
        
        <c:Spinner />            
    </aura:if>
    
    <aura:if isTrue="{!v.showError}">        
        <FieloELR:Error error="{!v.error}" />
    </aura:if>
    
</aura:component>